<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html xmlns:th="http://www.w3.org/1999/xhtml" lang="ru">
<head>
    <div th:replace="fragments/head :: head"></div>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<div class="wrapper d-flex justify-content-center" style="align-self: center">

    <header class="modal-header bg-primary container row"
            style=" border-radius: 1rem; text-shadow: 2px 2px 4px black; align-self: center;
                ">

        <div class="col" th:replace="fragments/nav/navroom :: navroom"></div>

    </header>
    <main class="main d-flex row" style="align-content: baseline;
        background-image: url('../img/bg/bdfon2.jpg');
        background-repeat: no-repeat; align-self: center;
        max-width: 80rem; border-radius: 1rem">

        <div class="col" th:replace="fragments/crud/crudrooms :: crudrooms"></div>

        <div class="table-result-db d-flex" style="justify-content: center; max-height: min-content">
            <div style="width: 40rem">

                <table class="row" style=" justify-content: center;
                  align-content: center; height: 3rem; table-layout: fixed">

                    <tr class="text-light fs-5" style="background-color: #62a0f6">
                        <th class="p-2 m-2 text-center align-self-center"
                            style="padding-left: 2vh; padding-right: 2vh; border-color: #62a0f6
                                ; width: 25rem">
                            Название филиала
                        </th>
                        <th class="p-2 m-2 text-center align-self-center"
                            style="padding-left: 2vh; padding-right: 2vh; border-color: #62a0f6
                                ; width: 15rem">
                            Количество кабинетов
                        </th>
                    </tr>

                </table>

                <div class="scroll-tbody">
                    <table class="col" style="align-self: center">

                        <div th:each="element : ${dtoList}">
                            <div class="col">
                                <tr style="align-self: center">
                                    <td class="p-2 m-2 text-center border border-1 border-dark"
                                        data-work-area-name="${element.workAreaName}"
                                        data-room-count="${element.roomsCount}"
                                        style="width: 25rem">
                                        <div>[[${element.workAreaName}]]</div>
                                    </td>
                                    <td class="p-2 m-2 text-center border border-1 border-dark"

                                        style="width: 15rem">
                                        <div>[[${element.roomsCount}]]</div>
                                    </td>
                                </tr>
                            </div>
                        </div>
                        <input type="hidden" name="${_csrf.parameterName}" value="${_csrf.token}"/>

                    </table>

                </div>
            </div>
            <div class="row" style="width: 40rem; height: 30rem; padding-left: 2rem">
                <canvas id="myChart" style="height: 30rem"></canvas>

                <script type="text/javascript">
                    // for (let i = 0; i < document.getElementsByName('dtoList').length; i++) {
                    //     workAreaLabelsArray[i] = rows[i]
                    //         .getAttribute('data-work-area-name');
                    //     roomsCountsArray[i] = rows[i]
                    //         .getAttribute('data-room-count');
                    // }

                    // rows.forEach(row => {
                    //     workAreaLabelsArray = row.querySelector('[data-work-area-name]')
                    //         .getAttribute('data-work-area-name');
                    //     roomsCountsArray = row.querySelector('[data-room-count]')
                    //         .getAttribute('data-room-count');
                    // });


                </script>

                <script>
                    const ctx = document.getElementById('myChart');
                    const rows = document.querySelectorAll('data-work-area-name');
                    let workAreaLabelsArray = [];
                    let roomsCountsArray = [];

                    rows.forEach((row) => {
                        const workAreaName = row.getAttribute('data-work-area-name');
                        const roomCount = parseInt(row.getAttribute('data-room-count'), 10); // Преобразуем в число

                        // Добавляем в массивы
                        workAreaLabelsArray.push(workAreaName);
                        roomsCountsArray.push(roomCount);
                    });

                    // rows.forEach((row, index) => {
                    //     workAreaLabelsArray[index] = row.getAttribute('data-work-area-name');
                    //     roomsCountsArray[index] = parseInt(row.getAttribute('data-room-count')); // Преобразуем в число
                    // });


                    new Chart(ctx, {
                        type: 'bar',
                        data: {
                            // labels: ['Red', 'Blue', 'Yellow', 'Green', 'Purple', 'Orange'],
                            labels: workAreaLabelsArray.map(row => row.workarea),
                            datasets: [{
                                label: '# of Rooms',
                                // data: [12, 19, 3, 5, 2, 3],
                                data: roomsCountsArray.map(row => row.count),
                                borderWidth: 1
                            }]
                        },
                        options: {
                            scales: {
                                y: {
                                    beginAtZero: true
                                }
                            }
                        }
                    });


                </script>
            </div>
        </div>
    </main>
    <footer>
        <div th:replace="fragments/footermain :: footermain"></div>
    </footer>
</div>


</html>